// ==UserScript==
// @name         YouTube Auto Unsubscribe (Working)
// @namespace    http://tampermonkey.net/
// @version      1.2
// @description  Automatically unsubscribes from all channels on YouTube's subscriptions list page (/feed/channels)
// @author       Jhon
// @match        https://www.youtube.com/feed/channels
// @grant        none
// ==/UserScript==

(function() {
    'use strict';

    let unsubscribed = 0;
    let total = 0;
    let buttons = [];

    // Create visual log box
    const logBox = document.createElement('div');
    logBox.style.position = 'fixed';
    logBox.style.top = '10px';
    logBox.style.right = '10px';
    logBox.style.background = '#111';
    logBox.style.color = '#0f0';
    logBox.style.padding = '10px';
    logBox.style.fontFamily = 'monospace';
    logBox.style.zIndex = '99999';
    logBox.style.maxHeight = '300px';
    logBox.style.overflowY = 'auto';
    document.body.appendChild(logBox);

    const log = msg => {
        const line = document.createElement('div');
        line.textContent = msg;
        logBox.appendChild(line);
    };

    // Scroll to bottom to load all channels
    const scrollToBottom = (callback) => {
        let prevHeight = 0;
        let sameCount = 0;

        const scrollInterval = setInterval(() => {
            window.scrollTo(0, document.documentElement.scrollHeight);
            const currentHeight = document.documentElement.scrollHeight;

            if (currentHeight === prevHeight) {
                sameCount++;
            } else {
                sameCount = 0;
                prevHeight = currentHeight;
            }

            if (sameCount > 4) {
                clearInterval(scrollInterval);
                callback();
            }
        }, 1000);
    };

    const confirmUnsubscribe = () => {
        const confirmBtn = document.querySelector('yt-confirm-dialog-renderer tp-yt-paper-button#confirm-button');
        if (confirmBtn) confirmBtn.click();
    };

    const unsubscribe = (index = 0) => {
        if (index >= buttons.length) {
            log(`âœ… Done! Unsubscribed from ${unsubscribed}/${total} channels.`);
            return;
        }

        const btn = buttons[index];
        if (!btn) {
            unsubscribe(index + 1);
            return;
        }

        btn.click();
        setTimeout(() => {
            confirmUnsubscribe();
            unsubscribed++;
            log(`ðŸ›‘ Unsubscribed ${unsubscribed}/${total}`);
            setTimeout(() => unsubscribe(index + 1), 1200);
        }, 700);
    };

    const startUnsubscribing = () => {
        buttons = Array.from(document.querySelectorAll('tp-yt-paper-button[aria-label], paper-button[aria-label]'))
            .filter(btn => {
                const label = btn.getAttribute('aria-label')?.toLowerCase() || '';
                return label.includes('subscribed') || label.includes('abonniert') || label.includes('suscrito');
            });

        total = buttons.length;

        if (total === 0) {
            log('âŒ No Subscribed buttons found. Are you sure you are on https://www.youtube.com/feed/channels ?');
            return;
        }

        log(`ðŸ”Ž Found ${total} subscriptions to unsubscribe from.`);
        unsubscribe();
    };

    log('â³ Scrolling to load all subscriptions...');
    scrollToBottom(() => {
        log('âœ… Loaded. Starting unsubscribe process...');
        setTimeout(startUnsubscribing, 2000);
    });
})();
